<<!DOCTYPE html>
<html>
<head>
	<title>NYC Taxi</title>

	<script src="papaparse.min.js"></script>

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
	<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-heat/v0.1.3/leaflet-heat.js'></script>

</head>
<body>
	<p id="t"> </p>

	<div id="map" style="width: 800; height: 500"></div>
	<script type="text/javascript">

		var file = "./trip_data_1.csv";
		var subset = [];
		var tp = "2013-01-13";
		var map = L.map("map");
		var heat;


		Papa.SCRIPT_PATH = "papaparse.min.js";

		Papa.parse(file, {
			delimiter: ",", // "" for auto-detect
			newline: "\n",	// auto-detect
			header: true,
			download: true,
			worker: true,
			step: function(row) {
				filter(row);
			},
			complete: function() {
				console.log("All done!");
				//print(subset);
				//createmap();

				console.log(JSON.stringify(subset));
			}
		});

		function filter(row){

			if (~row.data[0].pickup_datetime.indexOf(tp)) {
				var date = new Date(row.data[0].pickup_datetime);

				subset.push(row.data[0]);
			}

		}

		function print(data){
			var output = document.getElementById("t");

			for (var i = data.length - 1; i >= 0; i--) {
				output.innerHTML = output.innerHTML + "<br>" + data[i].pickup_datetime;
			}
		}

		var positions = [];

		function createmap(){

			map.setView([40.773985, -73.968429], 12);

			var layer = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png',{
				attribution: '&#169; OpenStreetMap contributors, &#169; CartoDB'
			});

			layer.addTo(map);

			console.log(subset);

			for (var i = subset.length - 1; i >= 0; i--) {
				var lat = subset[i].pickup_latitude;
				var lon = subset[i].pickup_longitude;
				// L.marker([lat,lon]).addTo(map);
				// positions.push(L.latLng(lat,lon));
			}

			/*var heat = L.heatLayer(positions, {
				minOpacity: 0,
				maxZoom: 19,
				max: 0.1,
				radius: 15,
				blur: 0,
				gradient: {0.2: 'blue', 1: 'violet'}
			}).addTo(map);*/


		}


	</script>
</body>
</html>